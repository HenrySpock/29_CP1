{% extends "base.html" %}

{% block content %}
<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">



<h2>List details for:</h2>
<h1 id="listNameDisplay">{{ image_list.name }}</h1>
{#<h1>{{ image_list.name }}</h1>#}

<div id="editing-buttons" style="display: none;">

    {% if image_list.category_id %} 

        <input type="text" id="listNameEdit" value="{{ image_list.name }}" style="display:none;">
        <button id="editListNameButton" data-list-id="{{ image_list.list_id }}" class="btn btn-primary" onclick="toggleListNameEdit()">Edit List Name</button>
        <button id="saveListNameButton" class="btn btn-primary" onclick="saveListName()" style="display:none;">Save List Name?</button>
        
        <form id="updateListNameForm" method="post" action="{{ url_for('list_routes.update_list_name', list_id=image_list.list_id) }}">
            <input type="hidden" name="new_name" value="">
            <input type="submit" class="btn btn-primary" value="Remove Category?">
        </form>

    {% else %}

    <button class="btn btn-primary" onclick="showCategoryForm()">Add a Category?</button>

    <div id="categoryForm" style="display: none;">
        <h1>Add a Category</h1>

        <form method="post" action="{{ url_for('list_routes.add_category_to_list', list_id=image_list.list_id) }}">
            Category: 
            <select name="category_name">
                <option value="">-- Choose existing or enter new --</option>
                {% for category in categories %}
                    <option value="{{ category.name }}">{{ category.name }}</option>
                {% endfor %}
            </select>
            Or enter new category: <input type="text" name="new_category"><br>
            
            <input type="submit" class="btn btn-primary" value="Add Category">
        </form>
    </div>

    {% endif %}

    <div class="mb-3" style="display: inline-block;">
        <a href="{{ url_for('image_routes.image_search', list_id=image_list.list_id) }}" class="btn btn-primary">Add Image</a>
    </div>

    <button id="editFieldsButton" data-list-id="{{ list_id }}" class="btn btn-primary">Edit Fields</button>
    
    <button id="reposition-btn" class="btn btn-primary">Reposition Images?</button>
    <button id="save-btn" class="btn btn-primary" style="display: none;">Save Position?</button>
</div>

<div class="row"> 
    {% for image in images %}
        <div class="col-md-3 col-sm-6 mb-4">
            <div class="card image-entry" data-creator-id="{{ image_list.creator_id }}" data-current-user-id="{{ current_user.id }}">
                <!-- Image Container -->
                <div class="card-img-top image-container">
                    <a href="{{ url_for('image_routes.view_full_image', image_id=image.image_id) }}">
                        <img src="{{ image.image_url }}" class="contained-img" data-image-id="{{ image.image_id }}" data-position="{{ image.image_positions.position }}" alt="{{ image.name }}">
                    </a>
                    <!-- Left Arrow for repositioning. Hidden for first image. -->
                    <i class="fas fa-arrow-left reposition-arrow left-arrow" style="display: none;" {% if loop.first %}style="display:none"{% endif %}></i>
                    <!-- Right Arrow for repositioning. Hidden for last image. -->
                    <i class="fas fa-arrow-right reposition-arrow right-arrow" style="display: none;" {% if loop.last %}style="display:none"{% endif %}></i>
                </div>
            
                <div class="card-body">
                    <!-- Image Details Here -->
                    <p><strong>Name:</strong> {{ image.name }}</p>

                    {% set field_values = image_field_values[image.image_id] %}
                    {% for field in fields %}
                        <p>{{ field.name }}: {{ field_values.get(field.id, '') }}</p>
                    {% endfor %}

                    <!-- Edit/Delete Image Buttons -->
                    <button class="btn btn-primary btn-sm" onclick="location.href='{{ url_for('image_routes.edit_image', list_id=list_id, image_id=image.image_id) }}?selected_image_url={{ image.image_url }}'">Edit this Image</button>
                    <button class="btn btn-danger btn-sm" onclick="if(confirm('Are you sure you want to delete this image?')) { location.href='{{ url_for('image_routes.delete_image', list_id=list_id, image_id=image.image_id) }}' }">Delete</button>
                </div>
            </div>
        </div>
    {% endfor %}
</div>

<script src="{{ url_for('static', filename='js/list_details.js') }}"></script>    
{% endblock %}  