{% extends "base.html" %}

{% block content %}

<h2>Lists</h2>

<label>
    <input type="radio" name="listType" value="yourLists" checked>Your Lists
</label>
<label>
    <input type="radio" name="listType" value="ourLists">Our Lists
</label>
<label>
    <input type="radio" name="listType" value="allLists">All Lists
</label>



{% macro report_modal() %}
<div id="reportModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeReportModal()">&times;</span>
        <h2>Report Issue</h2> 
        <form id="reportForm" action="{{ url_for('user_routes.report') }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" id="reportListId" name="reportListId">  
            <input type="hidden" id="reportCreatorId" name="reportCreatorId">

            <label for="name">Your Name:</label>
            <input type="text" id="name" name="name" required>  {# Name field #}
            
            <label for="email">Your Email:</label>
            <input type="email" id="email" name="email" required>  {# Email field #}
            
            <label for="content">Please describe your issue:</label>
            <textarea id="content" name="content" rows="4" cols="50" required></textarea>  {# Rename reportDescription to content #}
            
            <button type="submit" class="btn btn-primary">Submit Feedback</button>
        </form>
    </div>
</div>
{% endmacro %}


<div data-group="yourLists">
  <h2>Your Lists</h2>

  {% if has_new_lists %}
  <h3>Your New Lists</h3>
  {% for image_list in your_lists %}
      {% if image_list.images|length == 0 %}
          <a href="{{ url_for('list_routes.list_details', list_id=image_list.list_id) }}" class="list-card">
            {{ image_list.name }}<br>
          </a>
          <button onclick="if(confirm('Are you sure you want to delete this list? It will also delete all associated images and their data.')) { location.href='{{ url_for('list_routes.delete_list', list_id=image_list.list_id) }}' }">Delete This List?</button>
      {% endif %}
    {% endfor %}
  {% endif %}

  {#
  <h3>Your Uncategorized Lists</h3>
  {% for image_list in your_lists %}
      
      {% if not image_list.category_id %}
        <a href="{{ url_for('list_routes.list_details', list_id=image_list.list_id) }}" class="list-card">

          {% if image_list.images|length > 0 %}
            <img src="{{ image_list.images[0].image_url }}" alt="{{ image_list.images[0].name }}" width="100">
            {{ image_list.name }}<br>
          {% endif %}

        </a>
        <button onclick="if(confirm('Are you sure you want to delete this list? It will also delete all associated images and their data.')) { location.href='{{ url_for('list_routes.delete_list', list_id=image_list.list_id) }}' }">Delete This List?</button>
      {% endif %} 
 
  {% endfor %}
  #}

  <h3>Your Uncategorized Lists</h3>
    {% for image_list in your_lists %}
        {% if not image_list.category_id and image_list.images|length > 0 %}
            <a href="{{ url_for('list_routes.list_details', list_id=image_list.list_id) }}" class="list-card">
                <img src="{{ image_list.images[0].image_url }}" alt="{{ image_list.images[0].name }}" width="100">
                {{ image_list.name }}<br>
            </a>
            <button onclick="if(confirm('Are you sure you want to delete this list? It will also delete all associated images and their data.')) { location.href='{{ url_for('list_routes.delete_list', list_id=image_list.list_id) }}' }">Delete This List?</button>
        {% endif %} 
    {% endfor %}

  <h3>Your Categorized Lists</h3>
  {% for category in your_categories %}
      {# Create a flag to determine if the category contains any lists with images #}
      {% set display_category = namespace(found=false) %}
      {% for image_list in category.image_lists %}
          {% if image_list.creator_id == current_user.id and image_list.images|length > 0 %}
              {% set display_category.found = true %}
          {% endif %}
      {% endfor %}
  
      {# Display the category if it has lists with images #}
      {% if display_category.found %}
          <div class="card category-card mb-3" data-category-id="your-{{ category.category_id }}">
              <div class="card-body">
                  <h5 class="card-title">{{ category.name }}</h5>
              </div>
          </div>
          <div data-lists-for="your-{{ category.category_id }}" style="display: none;">
              {% for image_list in category.image_lists %}
                  {% if image_list.creator_id == current_user.id and image_list.images|length > 0 %}
                      <a href="{{ url_for('list_routes.list_details', list_id=image_list.list_id) }}" class="list-card">
                          <img src="{{ image_list.images[0].image_url }}" alt="{{ image_list.images[0].name }}" width="100">
                          {{ image_list.name }}<br>
                      </a>
                      <button onclick="if(confirm('Are you sure you want to delete this list? It will also delete all associated images and their data.')) { location.href='{{ url_for('list_routes.delete_list', list_id=image_list.list_id) }}' }">Delete This List?</button>
                  {% endif %}
              {% endfor %}
          </div>
      {% endif %}
  {% endfor %}
  
</div>


<!-- Our Lists -->
<div data-group="ourLists">
  <h2>Our Lists</h2>

  <h3>Our Uncategorized Lists</h3>
  {% for image_list in our_lists %}
      {% if not image_list.category_id %} 
        <a href="{{ url_for('list_routes.list_details', list_id=image_list.list_id) }}" class="list-card">

          {% if image_list.images|length > 0 %}
            <img src="{{ image_list.images[0].image_url }}" alt="{{ image_list.images[0].name }}" width="100">
            {{ image_list.name }}<br>
          {% endif %}

        </a>
      {% endif %}
  {% endfor %}

  <h3>Our Categorized Lists</h3>
  {% for category in our_categories %}
      {% if category.name != "Uncategorized" %}
          <div>
              <!-- <h5>{{ category.name }}</h5> -->
              <div class="card category-card mb-3" data-category-id="your-{{ category.category_id }}">
                  <div class="card-body">
                      <h5 class="card-title">{{ category.name }}</h5>
                  </div>
              </div>
              <div data-lists-for="your-{{ category.category_id }}" style="display: none;">
                {% for image_list in our_lists %}
                    {% if image_list.category_id == category.category_id %} 
                      <a href="{{ url_for('list_routes.list_details', list_id=image_list.list_id) }}" class="list-card">

                        {% if image_list.images|length > 0 %}
                          <img src="{{ image_list.images[0].image_url }}" alt="{{ image_list.images[0].name }}" width="100">
                          {{ image_list.name }}<br>
                        {% endif %}

                      </a>
                    {% endif %}
                {% endfor %}
              </div>
          </div>
      {% endif %}
  {% endfor %}
</div>
 
<!-- All Lists -->
<div data-group="allLists">
  <h2>All Lists</h2>

  <h3>All Uncategorized Lists</h3>
  {% for image_list in all_lists %}
      {% if not image_list.category_id %} 
        <a href="{{ url_for('list_routes.list_details', list_id=image_list.list_id) }}" class="list-card">

          {% if image_list.images|length > 0 %}
            <img src="{{ image_list.images[0].image_url }}" alt="{{ image_list.images[0].name }}" width="100">
            {{ image_list.name }}<br>
          {% endif %}
          
        </a>
        <button class="btn btn-danger" onclick="openReportModal('{{ image_list.list_id }}', '{{ image_list.creator_id }}')">Report</button>
        
        {% if current_user.is_admin %}
            <button onclick="if(confirm('Are you sure you want to delete this list? It will also delete all associated images and their data.')) { location.href='{{ url_for('list_routes.delete_list', list_id=image_list.list_id) }}' }">Administrative Deletion</button>
        {% endif %}
      {% endif %}
  {% endfor %}

  <h3>All Categorized Lists</h3>
  {% for category in all_categories %}
      {% if category.name != "Uncategorized" %}
          {# Create a flag to determine if the category contains any lists with images #}
          {% set display_category = namespace(found=false) %}
          {% for image_list in all_lists %}
              {% if image_list.category_id == category.category_id and image_list.images|length > 0 %}
                  {% set display_category.found = true %}
              {% endif %}
          {% endfor %}
  
          {# Display the category if it has lists with images #}
          {% if display_category.found %}
              <div>
                  <div class="card category-card mb-3" data-category-id="your-{{ category.category_id }}">
                      <div class="card-body">
                          <h5 class="card-title">{{ category.name }}</h5>
                      </div>
                  </div>
                  <div data-lists-for="your-{{ category.category_id }}" style="display: none;">
                      {% for image_list in all_lists %}
                          {% if image_list.category_id == category.category_id and image_list.images|length > 0 %}
                              <a href="{{ url_for('list_routes.list_details', list_id=image_list.list_id) }}" class="list-card">
                                  <img src="{{ image_list.images[0].image_url }}" alt="{{ image_list.images[0].name }}" width="100">
                                  {{ image_list.name }}<br>
                              </a>
                              <button class="btn btn-danger" onclick="openReportModal('{{ image_list.list_id }}', '{{ image_list.creator_id }}')">Report</button>

                              {% if current_user.is_admin %}
                                <button onclick="if(confirm('Are you sure you want to delete this list? It will also delete all associated images and their data.')) { location.href='{{ url_for('list_routes.delete_list', list_id=image_list.list_id) }}' }">Administrative Deletion</button>
                              {% endif %}
                          {% endif %}
                      {% endfor %}
                  </div>
              </div>
          {% endif %}
      {% endif %}
  {% endfor %}
  
</div>

{{ report_modal() }}

<script src="{{ url_for('static', filename='js/lists.js') }}"></script>
<script src="{{ url_for('static', filename='js/go_to_lists_modal.js') }}"></script>
{% endblock %}
  